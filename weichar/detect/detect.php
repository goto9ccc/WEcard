<?php

define( 'WORD_WIDTH', 25 );
define( 'WORD_HIGHT', 23 );
define( 'OFFSET_X', 10 );
define( 'OFFSET_Y', 36 );
define( 'WORD_SPACING', 13 );

class valite
{
    public function setImage($Image)
    {
        $this->ImagePath = $Image;
    }

    public function getData()
    {
        return $data;
    }

    public function getResult()
    {
        return $DataArray;
    }

    public function getHec()
    {
        $res = imagecreatefromjpeg($this->ImagePath);
        $size = getimagesize($this->ImagePath);
        $data = array();
        for ($i = 0; $i < $size[1]; ++$i) {
            for ($j = 0; $j < $size[0]; ++$j) {
                $rgb = imagecolorat($res, $j, $i);
                $rgbarray = imagecolorsforindex($res, $rgb);
                if ( $rgbarray['red'] < 30 || $rgbarray['green'] < 30 || $rgbarray['blue'] < 30 ) {
                    $data[$i][$j] = 1;
                    //echo '1';
                }
                else {
                    $data[$i][$j] = 0;
                    // echo '0';
                }
            }
            //echo "<br>";
        }
        $this->DataArray = $data;
        $this->ImageSize = $size;
    }

    public function getCode()
    {
        $k = 0;
        for ($j = 0; $j < 4; ++$j) {
            for ($i = 0; $i < 3; ++$i) {
                $demo = '';
                $x = ( $i * ( WORD_WIDTH + WORD_SPACING ) ) + OFFSET_X;
                $y = OFFSET_Y + $j * ( WORD_SPACING + WORD_HIGHT );
                for ($h = $y; $h < ( $y + WORD_HIGHT ); ++$h) {
                    for ($w = $x; $w < ( $x + WORD_WIDTH ); ++$w) {
                        $demo .= $this->DataArray[$h][$w];
                        //echo $this->DataArray[$h][$w];
                    }
                    //   echo '<br>';
                }
                //echo '<br>';

                //echo "'$k'=>'".$demo."',<br>";
                $k += 1;
            }
        }
    }

    public function run()
    {
        $result = "";
        $data = array("", "", "", "");
        $k = 0;
        for ($j = 0; $j < 4; ++$j) {
            for ($i = 0; $i < 3; ++$i) {
                $x = ( $i * ( WORD_WIDTH + WORD_SPACING ) ) + OFFSET_X;
                $y = OFFSET_Y + $j * ( WORD_SPACING + WORD_HIGHT );
                for ($h = $y; $h < ( $y + WORD_HIGHT ); ++$h) {
                    for ($w = $x; $w < ( $x + WORD_WIDTH ); ++$w) {
                        $data[$k] .= $this->DataArray[$h][$w];
                    }
                }
                $k += 1;
            }
        }


        foreach ($data as $numKey => $numString) {
            $max = 0.0;
            $num = 0;
            foreach ($this->Keys as $key => $value) {
                $percent = 0.0;
                similar_text($value, $numString, $percent);
                if ( intval($percent) > $max ) {
                    $max = $percent;
                    $num = $key;
                    if ( intval($percent) > 99 ) {
                        break;
                    }
                }
            }
            $result .= $num;
        }
        $this->data = $result;

        return $result;
    }

    public function Draw()
    {
        for ($i = 0; $i < $this->ImageSize[1]; ++$i) {
            for ($j = 0; $j < $this->ImageSize[0]; ++$j) {
                echo $this->DataArray[$i][$j];
            }
            echo "\n";
        }
    }

    public function __construct()
    {
        $this->Keys = array('1' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000111100000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000000110000000000000000000000111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '3' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111000000000000000000001101110000000000000000000100011000000000000000000000001100000000000000000000000100000000000000000000000110000000000000000000001111100000000000000000000000110000000000000000000000011100000000000000000000001110000000000000000000000110000000000000000000110011000000000000000000111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '0' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111100000000000000000000110011000000000000000000011001100000000000000000011100110000000000000000001110011100000000000000000111001110000000000000000011100111000000000000000001110011100000000000000000111001110000000000000000011100111000000000000000000110011000000000000000000011001100000000000000000000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '2' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111110000000000000000000110011000000000000000000011001110000000000000000000000111000000000000000000000011100000000000000000000001100000000000000000000000110000000000000000000000110000000000000000000000111000000000000000000000011000000000000000000000011000000000000000000000011100110000000000000000001111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '5' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111100000000000000000000100000000000000000000000110000000000000000000000010000000000000000000000011110000000000000000000000011110000000000000000000000011000000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000000110000000000000000001100110000000000000000000111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '4' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000001110000000000000000000000111000000000000000000000111100000000000000000000010110000000000000000000011011000000000000000000011001100000000000000000001100110000000000000000001111111100000000000000000000001100000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '7' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111000000000000000000110001100000000000000000010000110000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000000100000000000000000000000110000000000000000000000011000000000000000000000001100000000000000000000001100000000000000000000000110000000000000000000000011000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '8' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111000000000000000000011000110000000000000000001100011000000000000000000110001100000000000000000011101110000000000000000000111110000000000000000000001110000000000000000000001111100000000000000000001100111000000000000000000110001100000000000000000011000110000000000000000001100011000000000000000000011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '9' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111100000000000000000001100110000000000000000000110001100000000000000000011000110000000000000000001100011000000000000000000110001100000000000000000011001110000000000000000000111111000000000000000000000011100000000000000000000001100000000000000000000001110000000000000000000000110000000000000000000001110000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', '6' => '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001110000000000000000000001100000000000000000000001110000000000000000000000110000000000000000000000111000000000000000000000011111100000000000000000001100011000000000000000000110001100000000000000000011000110000000000000000001100011000000000000000000110001100000000000000000011100110000000000000000000111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',);
    }

    protected $ImagePath;
    protected $DataArray;
    protected $ImageSize;
    protected $data;
    protected $Keys;
    protected $NumStringArray;
}

?>